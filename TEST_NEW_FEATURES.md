# 신규 기능 테스트 가이드

## 통합 완료된 기능

다음 4가지 신규 기능이 MafiaGameServer에 통합되었습니다:

1. **익명 쪽지 시스템** (WhisperManager)
2. **감정 표현 시스템** (EmotionManager)
3. **역할 가이드** (RoleGuideManager)
4. **통계 조회** (StatisticsManager)

## 서버 시작 시 확인사항

서버를 시작하면 콘솔에 다음 메시지가 표시됩니다:

```
[System] 신규 기능 매니저 초기화 완료
[System] - 쪽지 시스템
[System] - 로비 시스템
[System] - 통계 및 업적
[System] - 실시간 투표 추적
[System] - 역할 가이드
[System] - 감정 표현
[System] - 재접속 지원
[System] - 이벤트 모드
```

## 테스트 방법

### 1. 익명 쪽지 시스템 테스트

**프로토콜**: `WHISPER:수신자이름:메시지내용`

**테스트 시나리오**:
```
1. 서버 실행 + 클라이언트 2개 접속 (P1, P2)
2. 게임 시작
3. 낮 시간에 P1이 다음 전송:
   WHISPER:P2:안녕하세요 비밀 메시지입니다
4. P2는 다음 메시지 수신:
   WHISPER: 익명의 누군가: 안녕하세요 비밀 메시지입니다
```

**제한사항**:
- 낮 시간에만 사용 가능
- 죽은 플레이어는 사용 불가
- 시간당 10개 제한 (스팸 방지)

**서버 로그 확인**:
```
[쪽지] P1 -> P2: 안녕하세요 비밀 메시지입니다
```

---

### 2. 감정 표현 시스템 테스트

**프로토콜**: `EMOTION:감정ID:대상` (대상은 선택사항)

**사용 가능한 감정 ID**:
- THUMBS_UP (👍 좋아요)
- THUMBS_DOWN (👎 싫어요)
- HEART (❤️ 하트)
- LAUGH (😂 웃음)
- CRY (😢 울음)
- ANGRY (😠 화남)
- SHOCKED (😱 충격)
- THINK (🤔 생각)
- CLAP (👏 박수)
- FIRE (🔥 불)
- SKULL (💀 해골)
- GHOST (👻 유령)
- DETECTIVE (🕵️ 탐정)
- KNIFE (🔪 칼)
- SHIELD (🛡️ 방패)
- CROSS (✝️ 십자가)
- QUESTION (❓ 물음표)
- EXCLAMATION (❗ 느낌표)
- ZZZ (💤 잠)

**테스트 시나리오 1 - 타겟 없는 감정**:
```
1. 게임 진행 중
2. P1이 전송: EMOTION:THUMBS_UP
3. 모든 플레이어가 수신:
   EMOTION: P1님이 👍 좋아요
```

**테스트 시나리오 2 - 타겟 있는 감정**:
```
1. P1이 전송: EMOTION:DETECTIVE:P2
2. 모든 플레이어가 수신:
   EMOTION: P1님이 P2님에게 🕵️ 탐정
```

**제한사항**:
- 3초 쿨다운
- 죽은 플레이어는 사용 불가

---

### 3. 역할 가이드 테스트

**프로토콜**: `/guide` 또는 `/guide 역할이름`

**테스트 시나리오 1 - 자신의 역할 가이드**:
```
1. 게임 시작 후 역할 배정됨
2. 채팅창에 입력: /guide
3. 자신의 역할에 대한 상세 가이드 수신
```

**테스트 시나리오 2 - 특정 역할 가이드**:
```
1. 채팅창에 입력: /guide MAFIA
2. 마피아 역할 가이드 수신
```

**사용 가능한 역할 이름**:
- MAFIA (마피아)
- DOCTOR (의사)
- POLICE (경찰)
- CITIZEN (시민)
- SPY (스파이)
- SOLDIER (군인)
- SHAMAN (영매)
- REPORTER (기자)
- GANGSTER (건달)
- POLITICIAN (정치인)
- PRIEST (성직자)
- GHOUL (도굴꾼)
- MADAME (마담)

**수신 형식**:
```
GUIDE:
============================================================
역할: 마피아 (MAFIA)
============================================================
진영: 마피아

설명: 밤에 시민을 제거하는 핵심 악역입니다.

능력: 밤마다 한 명의 플레이어를 제거할 수 있습니다.

전략:
• 초반에는 조용히 행동하며 의사와 경찰을 찾아 제거하세요.
• 마피아끼리 밤에 대화가 가능하므로 전략을 논의하세요.
...
```

---

### 4. 통계 조회 테스트

**프로토콜**: `/stats` 또는 `/stats 플레이어이름`

**테스트 시나리오 1 - 자신의 통계**:
```
1. 채팅창에 입력: /stats
2. 자신의 통계 정보 수신
```

**테스트 시나리오 2 - 다른 플레이어 통계**:
```
1. 채팅창에 입력: /stats P2
2. P2의 통계 정보 수신
```

**통계 정보 포함 내용**:
- 총 게임 수
- 승리 / 패배
- 승률
- MVP 획득 횟수
- 역할별 플레이 횟수
- 역할별 승리 횟수
- 획득한 업적

**업적 목록**:
1. FIRST_WIN - 첫 승리
2. TEN_WINS - 10승 달성
3. MAFIA_WIN - 마피아 팀 승리
4. CITIZEN_WIN - 시민 팀 승리
5. MVP - MVP 획득
6. VETERAN - 100게임 플레이
7. ALL_ROLES - 모든 역할 플레이

---

## 클라이언트 수정 없이 테스트하는 방법

현재 클라이언트는 이 프로토콜을 직접 지원하지 않으므로,
클라이언트를 수정하지 않고 테스트하려면:

### 방법 1: 채팅창 이용
클라이언트의 채팅창에 프로토콜을 직접 입력:
```
/guide
/guide MAFIA
/stats
/stats Player1
```

감정 표현과 쪽지는 채팅창으로는 테스트 불가 (프로토콜 형식 필요)

### 방법 2: 클라이언트 코드 임시 수정
MafiaGameClientView.java의 전송 버튼 이벤트에 테스트 코드 추가:

```java
// 테스트: 쪽지 보내기
if (msg.equals("/whisper")) {
    dos.writeUTF("WHISPER:Player2:테스트 쪽지입니다");
    return;
}

// 테스트: 감정 표현
if (msg.equals("/emotion")) {
    dos.writeUTF("EMOTION:THUMBS_UP:Player2");
    return;
}
```

---

## 서버 로그에서 확인 가능한 내용

신규 기능 사용 시 서버 콘솔에 다음과 같은 로그가 표시됩니다:

```
[쪽지] Player1 -> Player2: 안녕하세요
[감정] Player1: 👍 좋아요 -> Player2
Player1 역할 가이드 조회: MAFIA
Player1 통계 조회
Player2 통계 조회: Player1
```

---

## 다음 통합 예정

아직 통합되지 않은 기능들:

1. **로비 시스템** - 게임 시작 전 대기실
2. **실시간 투표 추적** - 투표 현황 실시간 표시
3. **AI 플레이어** - 봇 추가
4. **재접속 시스템** - 연결 끊김 복구
5. **이벤트 모드** - 시즌별 특별 이벤트

---

## 문제 해결

### 서버가 시작되지 않음
```bash
cd /Users/honggeunkim/Desktop/마피아2
mvn clean compile
java -cp target/classes mafia.game.MafiaGameServer
```

### 기능이 동작하지 않음
1. 서버 콘솔에서 "신규 기능 매니저 초기화 완료" 메시지 확인
2. 프로토콜 형식이 정확한지 확인
3. 게임 페이즈 확인 (쪽지는 낮 시간만 가능)
4. 플레이어 상태 확인 (죽은 플레이어는 대부분 기능 사용 불가)

### 서버 종료
```bash
pkill -f MafiaGameServer
```

---

**작성일**: 2025-12-03
**버전**: 2.0
**통합 상태**: 4/9 기능 (쪽지, 감정, 가이드, 통계)
